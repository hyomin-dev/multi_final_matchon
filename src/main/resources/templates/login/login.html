<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>로그인</title>
    <link rel="stylesheet" type="text/css" th:href="@{/css/header.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/css/footer.css}">
</head>
<body>


<div th:replace="~{common/header::header}"></div>
<div id="wrap">
    <h2>로그인 페이지</h2>
    <form id="loginForm">
        <input type="email" id="email" placeholder="이메일" required /><br/>
        <input type="password" id="password" placeholder="비밀번호" required /><br/>
        <button type="submit">로그인</button>
    </form>
</div>

<script>
    document.getElementById("loginForm").addEventListener("submit", function (e) {
        e.preventDefault();

        fetch("/auth/login", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                email: document.getElementById("email").value,
                password: document.getElementById("password").value
            })
        })
            .then(res => {
                if (!res.ok) {
                    return res.json().then(data => {
                        throw new Error(data.error || "로그인 실패");
                    });
                }
                return res.json();
            })
            .then(data => {
                localStorage.setItem("accessToken", data.accessToken);
                localStorage.setItem("refreshToken", data.refreshToken);
                alert("로그인 성공!");
                window.location.href = "/main"; // 로그인 후 메인으로 이동
            })
            .catch(err => {
                alert("에러: " + err.message);
            });
    });
</script>
<div th:replace="~{common/footer::footer}"></div>

</body>
</html>
