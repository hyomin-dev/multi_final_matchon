<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>로그인</title>
    <link rel="stylesheet" type="text/css" th:href="@{/css/header.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/css/footer.css}">
    <style>
        #wrap {
            max-width: 400px;
            margin: 60px auto;
            text-align: center;
            font-family: 'Noto Sans KR', sans-serif;
        }

        /* 제목 스타일 */
        #wrap h2 {
            font-size: 20px;
            font-weight: bold;
            border-bottom: 2px solid #111;
            display: inline-block;
            padding-bottom: 4px;
            margin-bottom: 25px;
        }

        /* 인풋 필드 */
        #loginForm input[type="email"],
        #loginForm input[type="password"] {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            font-size: 14px;
            border: 1px solid #aaa;
            border-radius: 6px;
            box-sizing: border-box;
        }

        /* 로그인 버튼 */
        #loginForm button[type="submit"] {
            width: 100%;
            background-color: #eabdc2;
            border: 1px solid #c88c95;
            color: white;
            font-weight: bold;
            padding: 12px;
            font-size: 15px;
            border-radius: 6px;
            cursor: pointer;
            margin-top: 15px;
            transition: background-color 0.2s ease;
        }

        #loginForm button[type="submit"]:hover {
            background-color: #d78e98;
        }

        /* 플레이스홀더 색상 */
        #loginForm input::placeholder {
            color: #aaa;
        }
    </style>
</head>
<body>

<div th:replace="~{common/header::header}"></div>
<div id="wrap">
    <h2>LOGIN</h2>
    <form id="loginForm">
        <input type="email" id="email" placeholder="이메일" required /><br/>
        <input type="password" id="password" placeholder="비밀번호" required /><br/>
        <button type="submit">로그인</button>
    </form>
</div>

<script>
    document.getElementById("loginForm").addEventListener("submit", function (e) {
        e.preventDefault();

        fetch("/auth/login", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            credentials: 'include',
            body: JSON.stringify({
                email: document.getElementById("email").value,
                password: document.getElementById("password").value
            })
        })
            .then(res => {
                if (!res.ok) {
                    return res.json().then(data => {
                        throw new Error(data.error || "로그인 실패");
                    });
                }
                return res.json();
            })
            .then(data => {
                // 쿠키에 토큰 자동 저장됨 → localStorage에 저장할 필요 없음
                // 로그인 성공 후 사용자 권한 확인
                fetch("/auth/check", {
                    method: "GET",
                    credentials: "include"
                })
                .then(res => res.json())
                .then(user => {
                    if (user.role === "ADMIN") {
                        alert("관리자로 로그인되었습니다.");
                        window.location.href = "/main";
                    } else {
                        alert("로그인 성공!");
                        window.location.href = "/main";
                    }
                });
            })
            .catch(err => {
                alert("에러: " + err.message);
            });
    });
</script>
<div th:replace="~{common/footer::footer}"></div>

</body>
</html>
