<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>게시판 목록</title>
    <link rel="stylesheet" th:href="@{/css/header.css}">
    <link rel="stylesheet" th:href="@{/css/footer.css}">
    <link rel="stylesheet" th:href="@{/css/community.css}">
</head>
<body class="flex-layout">
<div class="page-wrapper">
    <div th:replace="~{common/header::header}"></div>

    <h2 class="page-title" th:text="${selectedCategory != null} ? ${selectedCategory.displayName} : '자유게시판'">자유게시판</h2>
    <div style="text-align: right; width: 90%; margin: auto;">
        <a th:href="@{/community/new}" class="button">게시글 작성</a>
    </div>

    <div class="category-select-box">
        <select class="category-select">
            <option th:each="cat : ${categories}"
                    th:value="${cat}"
                    th:text="${cat.displayName}"
                    th:selected="${cat} == ${selectedCategory}">
            </option>
        </select>
    </div>

    <div id="board-list">
        <table>
            <tr>
                <th>작성자</th>
                <th>제목</th>
                <th>카테고리</th>
                <th>작성일</th>
            </tr>
            <tr th:each="board : ${boardsPage.content}">
                <td th:text="${board.member.memberName}"></td>
                <td><a th:href="@{'/community/' + ${board.id}}" th:text="${board.title}"></a></td>
                <td th:text="${board.category.displayName}"></td>
                <td th:text="${#temporals.format(board.createdDate, 'yyyy-MM-dd HH:mm')}"></td>
            </tr>
        </table>

        <div class="pagination">
            <a th:if="${boardsPage.hasPrevious()}" th:href="@{/community(page=${boardsPage.number - 1}, category=${selectedCategory})}">이전</a>

            <a th:each="i : ${#numbers.sequence(0, boardsPage.totalPages - 1)}"
               th:href="@{/community(page=${i}, category=${selectedCategory})}"
               th:text="${i + 1}"
               th:classappend="${i == boardsPage.number} ? 'active' : ''"></a>

            <a th:if="${boardsPage.hasNext()}" th:href="@{/community(page=${boardsPage.number + 1}, category=${selectedCategory})}">다음</a>
        </div>
    </div>

</div>
<div th:replace="~{common/footer::footer}"></div>

<script>
    document.querySelector('.category-select').addEventListener('change', function () {
        const selectedCategory = this.value;

        fetch(`/community?category=${selectedCategory}`)
            .then(response => response.text())
            .then(html => {
                const tempDom = document.createElement('div');
                tempDom.innerHTML = html;

                const newBoardList = tempDom.querySelector('#board-list');
                document.querySelector('#board-list').replaceWith(newBoardList);

                const newTitle = tempDom.querySelector('.page-title');
                document.querySelector('.page-title').textContent = newTitle.textContent;
            });
    });
</script>
</body>
</html>
