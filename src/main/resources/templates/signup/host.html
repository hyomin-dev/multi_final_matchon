<!DOCTYPE html>
<html lang="en">
<head>
    <title>주최자 회원가입</title>
    <link rel="stylesheet" type="text/css" th:href="@{/css/header.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/css/footer.css}">
</head>
<body>
<div th:replace="~{common/header::header}"></div>
<div id="wrap">
<!-- 드롭다운 메뉴 -->
<select id="roleSelect" onchange="changeRole()">
    <option value="user">사용자</option>
    <option value="host" selected>주최자</option>
</select>
<h2>주최자 회원가입</h2>
<form id="signupHostForm">
    <input type="email" id="email" placeholder="이메일" required />
    <input type="password" id="password" placeholder="비밀번호" required />
    <input type="text" id="name" placeholder="이름" required />
    <label>종목</label>
    <select id="sportsTypeSelect" required></select>
    <button type="submit">회원가입</button>
</form>

<script>

    // 사용자로 전환
    function changeRole() {
        const role = document.getElementById("roleSelect").value;
        if (role === "user") {
            window.location.href = "/signup/user";
        }
    }

    // 페이지 로딩 시 종목 목록 불러오기
    window.addEventListener("DOMContentLoaded", () => {
        fetch("/api/common/datacontroller/sports-types")
            .then(res => res.json())
            .then(data => {
                const sportsSelect = document.getElementById("sportsTypeSelect");
                data.forEach(s => {
                    const option = document.createElement("option");
                    option.value = s.id;
                    option.textContent = s.sportsTypeName;
                    sportsSelect.appendChild(option);
                });
            });
    });

    // 주최자 회원가입 요청
    document.getElementById("signupHostForm").addEventListener("submit", e => {
        e.preventDefault();
        fetch("/auth/signup/host", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                email: document.getElementById("email").value,
                password: document.getElementById("password").value,
                name: document.getElementById("name").value,
                sportsTypeId: document.getElementById("sportsTypeSelect").value
            })
        })
            .then(res => {
                if (res.ok) {
                    alert("회원가입 성공!");
                    window.location.href = "/login";
                } else {
                    return res.json().then(data => alert(data.error || "회원가입 실패"));
                }
            });
    });
</script>
</div>

<div th:replace="~{common/footer::footer}"></div>
</body>
</html>