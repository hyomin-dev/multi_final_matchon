<!DOCTYPE html>
<html lang="ko">
<head>
    <title>사용자 회원가입</title>
    <link rel="stylesheet" type="text/css" th:href="@{/css/header.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/css/footer.css}">
</head>
<body>
<div th:replace="~{common/header::header}"></div>
<div id="wrap">
<!-- 드롭다운 메뉴 -->
<select id="roleSelect" onchange="changeRole()">
    <option value="user" selected>사용자</option>
    <option value="host">주최자</option>
</select>

<h2>사용자 회원가입</h2>

<form id="signupForm">
    <input type="email" id="email" placeholder="이메일" required />
    <input type="password" id="password" placeholder="비밀번호" required />
    <input type="text" id="name" placeholder="이름" required />
<<<<<<< HEAD
<!--    <label>종목</label>-->
<!--    <select id="sportsTypeSelect"></select>-->
<!--    <label>포지션</label>-->
<!--    <select id="positionSelect"></select>-->
=======
    <label>종목</label>
    <select id="sportsTypeSelect"></select>
    <label>포지션</label>
    <select id="positionSelect"></select>
>>>>>>> bf0050f (기능 1차 완료 - 로그인/회원가입/로그아웃 로직 (CSS 제외) + AuthServiceImpl 수정x)
    <button type="submit">회원가입</button>
</form>

<script>
    // 역할 변경 시 페이지 이동
    function changeRole() {
        const role = document.getElementById("roleSelect").value;
        if (role === "host") {
            window.location.href = "/signup/host"; // 주최자 회원가입 페이지로 이동
        }
    }

<<<<<<< HEAD
    // // // 페이지 로딩 시 종목 먼저 불러오기
    // window.addEventListener("DOMContentLoaded", () => {
    //     fetch("/api/common/datacontroller/sports-types")
    //         .then(res => res.json())
    //         .then(data => {
    //             const sportsSelect = document.getElementById("sportsTypeSelect");
    //             data.forEach(s => {
    //                 const option = document.createElement("option");
    //                 option.value = s.id;
    //                 option.textContent = s.sportsTypeName;
    //                 sportsSelect.appendChild(option);
    //             });
    //             // 첫 번째 종목 선택 후 포지션도 불러오기
    //             if (sportsSelect.value) {
    //                 loadPositions(sportsSelect.value);
    //             }
    //         });
    //
    //     document.getElementById("sportsTypeSelect").addEventListener("change", function () {
    //         loadPositions(this.value);
    //     });
    // });
    //
    // // 포지션 불러오는 함수
    // function loadPositions(sportsTypeId) {
    //     fetch("/api/common/datacontroller/positions?sportsTypeId=" + sportsTypeId)
    //         .then(res => res.json())
    //         .then(data => {
    //             const positionSelect = document.getElementById("positionSelect");
    //             positionSelect.innerHTML = ""; // 기존 옵션 비우기
    //             data.forEach(p => {
    //                 const option = document.createElement("option");
    //                 option.value = p.id;
    //                 option.textContent = p.positionName;
    //                 positionSelect.appendChild(option);
    //             });
    //         });
    // }
=======
    // 페이지 로딩 시 종목 먼저 불러오기
    window.addEventListener("DOMContentLoaded", () => {
        fetch("/api/common/datacontroller/sports-types")
            .then(res => res.json())
            .then(data => {
                const sportsSelect = document.getElementById("sportsTypeSelect");
                data.forEach(s => {
                    const option = document.createElement("option");
                    option.value = s.id;
                    option.textContent = s.sportsTypeName;
                    sportsSelect.appendChild(option);
                });
                // 첫 번째 종목 선택 후 포지션도 불러오기
                if (sportsSelect.value) {
                    loadPositions(sportsSelect.value);
                }
            });

        document.getElementById("sportsTypeSelect").addEventListener("change", function () {
            loadPositions(this.value);
        });
    });

    // 포지션 불러오는 함수
    function loadPositions(sportsTypeId) {
        fetch("/api/common/datacontroller/positions?sportsTypeId=" + sportsTypeId)
            .then(res => res.json())
            .then(data => {
                const positionSelect = document.getElementById("positionSelect");
                positionSelect.innerHTML = ""; // 기존 옵션 비우기
                data.forEach(p => {
                    const option = document.createElement("option");
                    option.value = p.id;
                    option.textContent = p.positionName;
                    positionSelect.appendChild(option);
                });
            });
    }
>>>>>>> bf0050f (기능 1차 완료 - 로그인/회원가입/로그아웃 로직 (CSS 제외) + AuthServiceImpl 수정x)

    // 사용자 회원가입 요청
    document.getElementById("signupForm").addEventListener("submit", function(e) {
        e.preventDefault();

        fetch("/auth/signup/user", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                email: document.getElementById("email").value,
                password: document.getElementById("password").value,
                name: document.getElementById("name").value,
<<<<<<< HEAD
                // sportsTypeId: document.getElementById("sportsTypeSelect").value,
                // positionId: document.getElementById("positionSelect").value
=======
                sportsTypeId: document.getElementById("sportsTypeSelect").value,
                positionId: document.getElementById("positionSelect").value
>>>>>>> bf0050f (기능 1차 완료 - 로그인/회원가입/로그아웃 로직 (CSS 제외) + AuthServiceImpl 수정x)
            })
        })
            .then(res => {
                if (res.ok) {
                    alert("회원가입 성공!");
                    window.location.href = "/login";
                } else {
                    return res.json().then(data => {
                        alert(data.error || "회원가입 실패");
                    });
                }
            });
    });

</script>
</div>

<div th:replace="~{common/footer::footer}"></div>
</body>
</html>