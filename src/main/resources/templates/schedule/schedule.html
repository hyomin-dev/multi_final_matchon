<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>대회 일정</title>
    <link rel="stylesheet" type="text/css" th:href="@{/css/header.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/css/footer.css}">
    <style>
        html, body {
            margin: 0;
            padding: 0;
            font-family: 'Arial', sans-serif;
            background: white;
            overflow-x: hidden;
        }

        #wrap {
            padding: 30px 0 30px 0;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            position: relative;
            padding: 10px;
        }

        .header {
            text-align: center;
        }

        .region-labels {
            text-align: center;
            margin: 10px 0 20px;
        }

        .region-dot {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin: 0 6px;
        }

        .month-title {
            text-align: center;
            font-size: 22px;
            font-weight: bold;
            margin-top: 20px;
        }

        .register-btn {
            display: block;
            margin: 10px auto;
            padding: 6px 16px;
            background-color: #4285f4;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }

        .calendar-wrapper {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 10px;
        }

        .calendar-nav-img {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 30px;
            height: 30px;
            cursor: pointer;
            z-index: 2;
        }

        .left-arrow { left: -40px; }
        .right-arrow { right: -40px; }

        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            width: 100%;
            max-width: 800px;
        }

        .day-header {
            font-weight: bold;
            text-align: center;
            border-top: 2px solid #888;
            border-bottom: 2px solid #888;
            background: transparent;
        }

        .day-header.sunday { color: red; }
        .day-header.saturday { color: blue; }

        .day-cell {
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            padding-top: 6px;
            cursor: pointer;
            border: 1px solid #ddd;
            border-left: none;
            border-right: none;
            transition: background-color 0.3s;
        }

        .day-cell.today {
            color: steelblue;
        }

        .day-cell.selected {
            background-color: #cce5ff;
        }

        .day-number {
            font-weight: bold;
            margin-bottom: 4px;
        }

        .event-label {
            font-size: 12px;
            padding: 2px 4px;
            border-radius: 4px;
            margin-top: 6px;
            background-color: #ffc3c3;
            color: #000;
        }

        .day-number.sunday {
            color: red;
        }
    </style>
</head>
<body>
<div th:replace="~{common/header::header}"></div>
<div id="wrap">
    <div class="container">
        <div class="header">
            <h1>대회 일정</h1>
            <div class="region-labels">
                <span class="region-dot" style="background-color:#FFC3C3;"></span> 수도권
                <span class="region-dot" style="background-color:#FFC582;"></span> 제주권
                <span class="region-dot" style="background-color:#FFEDA3;"></span> 영남권
                <span class="region-dot" style="background-color:#C7FAB8;"></span> 호남권
                <span class="region-dot" style="background-color:#B5DBFF;"></span> 충청권
                <span class="region-dot" style="background-color:#E7D0FF;"></span> 경상권
            </div>
        </div>

        <div class="month-title" id="monthYear"></div>
        <button class="register-btn" onclick="submitSelectedDate()">등록하기</button>

        <div class="calendar-wrapper">
            <img src="/img/back.png" class="calendar-nav-img left-arrow" onclick="changeMonth(-1)">
            <img src="/img/go.png" class="calendar-nav-img right-arrow" onclick="changeMonth(1)">
            <div class="calendar" id="calendar"></div>
        </div>
    </div>
</div>
<div th:replace="~{common/footer::footer}"></div>

<script>
    const calendar = document.getElementById("calendar");
    const monthYear = document.getElementById("monthYear");
    let selectedCell = null;
    let selectedDate = null;

    let today = new Date();
    let currentYear = today.getFullYear();
    let currentMonth = today.getMonth();

    const monthNames = ['JAN', 'FEB', 'MAR', 'APR', 'MAY', 'JUN',
        'JUL', 'AUG', 'SEP', 'OCT', 'NOV', 'DEC'];
    const weekDays = ['SUN', 'MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT'];

    function renderCalendar(year, month) {
        calendar.innerHTML = "";

        weekDays.forEach((day, i) => {
            const header = document.createElement("div");
            header.classList.add("day-header");
            if (i === 0) header.classList.add("sunday");
            if (i === 6) header.classList.add("saturday");
            header.textContent = day;
            calendar.appendChild(header);
        });

        const daysInMonth = new Date(year, month + 1, 0).getDate();
        const startDay = new Date(year, month, 1).getDay();

        for (let i = 0; i < startDay; i++) {
            const empty = document.createElement("div");
            empty.classList.add("day-cell");
            calendar.appendChild(empty);
        }

        for (let day = 1; day <= daysInMonth; day++) {
            const cell = document.createElement("div");
            cell.classList.add("day-cell");

            const dateObj = new Date(year, month, day);
            const isToday = dateObj.toDateString() === new Date().toDateString();
            if (isToday) {
                cell.classList.add("today");
            }

            const dayNum = document.createElement("div");
            dayNum.classList.add("day-number");

            // 일요일 색상 처리
            if (new Date(year, month, day).getDay() === 0) {
                dayNum.classList.add("sunday");
            }

            dayNum.textContent = day;
            cell.appendChild(dayNum);

            // 라벨 예시
            if (day === 3 || day === 14) {
                const label = document.createElement("div");
                label.classList.add("event-label");
                label.textContent = "지역 리그 경기";
                cell.appendChild(label);
            }

            cell.onclick = () => {
                if (selectedCell) {
                    selectedCell.classList.remove("selected");
                }
                cell.classList.add("selected");
                selectedCell = cell;

                selectedDate = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
            };

            calendar.appendChild(cell);
        }

        monthYear.textContent = `${monthNames[month]} ${year}`;
    }

    function changeMonth(offset) {
        currentMonth += offset;
        if (currentMonth < 0) {
            currentMonth = 11;
            currentYear--;
        } else if (currentMonth > 11) {
            currentMonth = 0;
            currentYear++;
        }
        renderCalendar(currentYear, currentMonth);
    }

    function submitSelectedDate() {
        if (!selectedDate) {
            alert("날짜를 선택해주세요.");
            return;
        }
        window.location.href = `/events/new?selectedDate=${selectedDate}`;
    }

    renderCalendar(currentYear, currentMonth);
</script>
</body>
</html>
